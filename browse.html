<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Browse Tools - letmeBurrow</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="images/png" href="images/logo.png">
</head>
<body>

<header>
    <div id="navbar"></div>
</header>

<main class="browse-container">
    <h2 class="browse-heading">Explore Available Tools</h2>

    <div class="tool-grid" id="toolGrid">
        <!-- Tools will load here dynamically -->
    </div>
</main>

<footer>
    <p>&copy; 2025 letmeBurrow.com | Tool Renting Marketplace</p>
</footer>

<!-- Modal for Renting -->
<div id="rentModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2 style="margin-top: 50px;">Rent Tool</h2>
        <form id="rentalForm" onsubmit="submitRental(event)">
            <input type="hidden" id="toolId" name="tool_id">
            <input type="text" id="renterName" name="renter_name" placeholder="Your Name" required>
            <input type="email" id="renterEmail" name="renter_email" placeholder="Your Email" required>
            <input type="number" id="rentalDuration" name="rental_duration" placeholder="Days to Rent" required min="1">
            <input type="submit" value="Confirm Rental">
        </form>
    </div>
</div>





<script>
// Load navbar dynamically
fetch('navbar.html')
    .then(res => res.text())
    .then(data => {
        document.getElementById('navbar').innerHTML = data;
    });

// Fetch and display tools dynamically from backend (Python Flask)
document.addEventListener("DOMContentLoaded", function() {
    fetch('http://127.0.0.1:5000/get_tools')
        .then(response => response.json())
        .then(tools => {
            const grid = document.getElementById('toolGrid');
            grid.innerHTML = '';  // Clear the grid before adding tools

            tools.forEach(tool => {
                const card = document.createElement('div');
                card.className = 'tool-card';
                card.innerHTML = `
                    <img src="${tool.image}" alt="${tool.name}">
                    <h3>${tool.name}</h3>
                    <p>${tool.description}</p>
                    <div class="price">$${tool.price_per_day}/day</div>
                    <button onclick="openModal(${tool.id})">Rent Now</button>
                `;
                grid.appendChild(card);
            });
        })
        .catch(error => {
            console.error('Error loading tools:', error);
        });
});

// Modal Logic
// Open the modal when "Rent Now" is clicked
function openModal(toolId) {
    console.log('Opening modal for tool ID:', toolId);  // Debugging log
    document.getElementById("rentModal").style.display = "block";
    document.getElementById("toolId").value = toolId;
}

// Close the modal when close button is clicked
function closeModal() {
    document.getElementById("rentModal").style.display = "none";
}

// Close the modal when clicking outside the modal
window.onclick = function(event) {
    const modal = document.getElementById("rentModal");
    if (event.target == modal) {
        closeModal();
    }
}

// Submit the rental form to backend (Flask)
function submitRental(event) {
    event.preventDefault();

    const toolId = document.getElementById('toolId').value;
    const renterName = document.getElementById('renterName').value;
    const renterEmail = document.getElementById('renterEmail').value;
    const rentalDuration = document.getElementById('rentalDuration').value;

    fetch('http://127.0.0.1:5000/save_rental', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            tool_id: toolId,
            renter_name: renterName,
            renter_email: renterEmail,
            rental_duration: rentalDuration
        })
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message);
        closeModal();
        document.getElementById('rentalForm').reset();
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Failed to submit rental.');
    });
}

</script>

</body>
</html>
